<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Interactive document clustering</title>

    <script src="https://code.jquery.com/jquery-latest.min.js" type="text/javascript"></script>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css"
          integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO" crossorigin="anonymous">

    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js"
            integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49"
            crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js"
            integrity="sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy"
            crossorigin="anonymous"></script>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.5.0/css/font-awesome.min.css">

    <script src="https://www.highcharts.com/media/com_demo/js/highslide-full.min.js"></script>
    <script src="https://www.highcharts.com/media/com_demo/js/highslide.config.js" charset="utf-8"></script>
    <link rel="stylesheet" type="text/css" href="https://www.highcharts.com/media/com_demo/css/highslide.css"/>
    <script src="https://code.highcharts.com/highcharts.js"></script>
    <script src="https://code.highcharts.com/modules/data.js"></script>
    <script src="https://code.highcharts.com/modules/series-label.js"></script>
    <script src="https://code.highcharts.com/modules/exporting.js"></script>
    <script src="https://code.highcharts.com/modules/export-data.js"></script>
</head>
<body>

<div class="container">
    <div class="row">
        <div class="col-sm-3">
            <h2>Options</h2>
            <br/>
            <label for="dataset-select">Dataset</label>
            <select id="dataset-select">
                <option>BBC</option>
                <option>20 News Groups</option>
            </select>
            <br/>
            <label for="algorithm-select">Algorithm</label>
            <select id="algorithm-select">
                <option>iKMeans</option>
                <option>Birch</option>
                <option>means</option>
                <option>DBSCAN</option>
                <option>spectral</option>
                <option>affinity</option>
            </select>
            <label for="numOfClusters">Number of Clusters</label>
            <input class="form-control" id="numOfClusters" placeholder="5">

            <button type="submit" class="btn btn-primary" onclick="submit_options()">Submit</button>
        </div>
        <div class="col-sm-8" style="text-align: center">
            <h1>Interactive Document Clustering</h1>
            <div id="container" style="min-width: 310px; height: 500px; width: 100%; margin: 0 auto">
                <i class="fa fa-spinner fa-pulse fa-3x fa-fw"></i>
            </div>
            <br>
            <span style="font-size: 18pt; font-weight: bold">Cluster key terms</span> <a href="#" data-toggle="modal"
                                                                                         data-target="#editModal">Edit
            terms</a>
            <table id="cluster_terms" class="table table-striped table-sm table-hover">
                <thead class="thead-dark">
                <th style="width: 10%;">Cluster</th>
                <th>Terms</th>
                </thead>
                <tbody></tbody>
            </table>
        </div>
    </div>

    <div class="modal fade" id="uploadModal" tabindex="-1" role="dialog" aria-labelledby="uploadModalLabel"
         aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="exampleModalLabel">Coming soon...</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    ...
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                    <button type="button" class="btn btn-primary" data-dismiss="modal">OK</button>
                </div>
            </div>
        </div>
    </div>

    <div class="modal fade" id="editModal" tabindex="-1" role="dialog" aria-labelledby="editModalLabel"
         aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="exampleModalLabel">Edit cluster terms</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <div class="form-group">
                        <label for="comment">One line for each cluster, space separated terms</label>
                        <textarea class="form-control" rows="10" id="terms"></textarea>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                    <button type="button" class="btn btn-primary" data-dismiss="modal" onclick="update()">OK</button>
                </div>
            </div>
        </div>
    </div>
</div>
</body>
</html>

<script type="text/javascript">

    function submit_options() {
        $("#container").html('<i class="fa fa-spinner fa-pulse fa-3x fa-fw"></i>');
        console.log($("#algorithm-select").val());
        console.log($("#dataset-select").val());
        console.log($("#numOfClusters").val());

        $.ajax({
            url: "/load",
            type: "POST",
            dataType: "json",
            data: JSON.stringify({
                algorithm: $("#algorithm-select").val(),
                dataset: $("#dataset-select").val(),
                numOfClusters: $("#numOfClusters").val()
            }),
            contentType: 'application/json;charset=UTF-8',
            success: function (data) {
                render(data);
                console.log(data);
            }
        });
    }

    function update() {
        $("#cluster_terms tbody").html('');
        $("#container").html('<i class="fa fa-spinner fa-pulse fa-3x fa-fw"></i>');
        console.log($("#terms").val());

        $.ajax({
            url: "/update",
            type: "POST",
            dataType: "json",
            data: JSON.stringify({terms: $("#terms").val()}),
            contentType: 'application/json;charset=UTF-8',
            success: function (data) {
                render(data);
                console.log(data);
            }
        });
    }

    function scatter(data) {
        console.log(data);
        Highcharts.chart('container', {
            chart: {
                type: 'scatter',
                zoomType: 'xy'
            },
            exporting: {enabled: false},
            credits: {enabled: false},
            title: {
                text: null
            },
            subtitle: {
                text: null
            },
            xAxis: {
                title: {
                    enabled: true,
                    text: 'Principal component 1'
                },
                startOnTick: true,
                endOnTick: true,
                showLastLabel: true
            },
            yAxis: {
                title: {
                    text: 'Principal component 2'
                }
            },
            legend: {enabled: false},
            plotOptions: {
                scatter: {
                    marker: {
                        radius: 5,
                        states: {
                            hover: {
                                enabled: true,
                                lineColor: 'rgb(100,100,100)'
                            }
                        }
                    },
                    states: {
                        hover: {
                            marker: {
                                enabled: false
                            }
                        }
                    },
                    tooltip: {
                        headerFormat: '<b>{series.name}</b><br>',
                        pointFormat: '<b>Text:</b><br>{point.name}'
                    }
                }
            },
            series: data
        });
    }

    function render(data) {
        scatter(data['pca']);
        const keyTerms = data['cluster_key_terms'];
        console.log(keyTerms);
        $("#cluster_terms").find("tr:gt(0)").remove();
        for (const clusterIndex in keyTerms) {
            if (keyTerms.hasOwnProperty(clusterIndex)) {
                const terms = keyTerms[clusterIndex].slice(0, 10).join(' ');
                $("#cluster_terms tbody").append(`<tr><td>${parseInt(clusterIndex) + 1}</td><td>${terms}</td></tr>`);
                $("#terms").append(terms + '\n');
            }
        }

        var first = true;
        $('#cluster_terms tr').each(function() {
            if (first) {
                first = false;
                return true;
            }
            this.addEventListener("mouseover", function(){
                console.log(keyTerms[this.getElementsByTagName("td")[0].innerText - 1]);
            });
         });
    }

    $.ajax({
        url: "/start",
        type: "GET",
        dataType: "json",
        success: [
            function (data) {
                render(data);
            }
        ]
    });


</script>